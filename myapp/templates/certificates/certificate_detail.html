{% extends "base.html" %}
{% load static %}

{% block title %}Certificate - {{ certificate.module.name }}{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <!-- Certificate Container with Fancy Border -->
    <div class="max-w-4xl mx-auto bg-white rounded-xl shadow-2xl overflow-hidden border-8 border-white relative">
        <!-- Decorative Elements -->
        <div class="absolute top-0 left-0 w-24 h-24 opacity-20">
            <svg viewBox="0 0 100 100" class="text-blue-500">
                <path d="M50 0 L100 50 L50 100 L0 50 Z" fill="currentColor"></path>
            </svg>
        </div>
        <div class="absolute bottom-0 right-0 w-24 h-24 opacity-20 transform rotate-180">
            <svg viewBox="0 0 100 100" class="text-blue-500">
                <path d="M50 0 L100 50 L50 100 L0 50 Z" fill="currentColor"></path>
            </svg>
        </div>
        
        <!-- Certificate Header with Improved Gradient -->
        <div class="bg-gradient-to-r from-blue-600 via-blue-700 to-blue-800 py-8 px-10 text-white relative overflow-hidden">
            <!-- Decorative Circles -->
            <div class="absolute -right-10 -top-10 w-32 h-32 rounded-full bg-blue-500 opacity-20"></div>
            <div class="absolute -left-10 -bottom-10 w-40 h-40 rounded-full bg-blue-400 opacity-20"></div>
            
            <div class="flex justify-between items-center relative z-10">
                <div>
                    <h1 class="text-4xl font-bold tracking-tight">Certificate of Completion</h1>
                    <p class="mt-2 opacity-90 text-blue-100">Issued by {{ site_name }}</p>
                </div>
                <div class="bg-white rounded-full p-3 shadow-lg transform hover:scale-110 transition-transform">
                    <i class="fas fa-certificate text-blue-600 text-5xl"></i>
                </div>
            </div>
        </div>

        <!-- Certificate Body with Enhanced Styling -->
        <div class="p-10 text-center border-b border-gray-200 relative overflow-hidden">
            <!-- Watermark Background -->
            <div class="absolute inset-0 flex items-center justify-center opacity-10 z-0">
                <svg width="400" height="400" viewBox="0 0 200 200" class="text-blue-500">
                    <path d="M50 0 L100 50 L50 100 L0 50 Z" fill="currentColor" transform="translate(100,100) scale(1.8)"></path>
                </svg>
            </div>
            
            <div class="relative z-10">
                <p class="text-gray-600 mb-6 text-lg italic">This is to certify that</p>
                <h2 class="text-5xl font-bold text-gray-900 mb-6 font-serif tracking-wide">{{ certificate.user.username }}</h2>
                <div class="w-32 h-1 bg-gradient-to-r from-blue-400 to-blue-600 mx-auto my-8 rounded-full"></div>
                <p class="text-gray-700 text-xl mb-6">has successfully completed the course</p>
                <h3 class="text-3xl font-semibold text-blue-600 mb-8 bg-blue-50 px-6 py-3 rounded-lg inline-block border border-blue-100">{{ certificate.module.name }}</h3>
                <div class="w-32 h-1 bg-gradient-to-r from-blue-400 to-blue-600 mx-auto my-8 rounded-full"></div>
                <p class="text-gray-600 text-lg">on {{ certificate.date_issued|date:"F j, Y" }}</p>
            </div>
        </div>

        <!-- Certificate Footer with Improved Layout -->
        <div class="p-8 bg-gray-50">
            <div class="flex flex-col md:flex-row justify-between items-center">
                <div class="mb-6 md:mb-0 text-center md:text-left">
                    <p class="text-sm text-gray-500 uppercase tracking-wider mb-1">Certificate ID</p>
                    <p class="font-mono text-lg font-bold text-gray-800 bg-gray-100 px-3 py-1 rounded inline-block">{{ certificate.certificate_id }}</p>
                </div>
                <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                    <a href="?format=pdf" 
                       class="bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white px-6 py-3 rounded-lg flex items-center justify-center shadow-md hover:shadow-lg transition-all">
                        <i class="fas fa-file-pdf mr-3 text-xl"></i> 
                        <span class="font-medium">Download PDF</span>
                    </a>
                    <button onclick="shareCertificate()" 
                            class="bg-gradient-to-r from-gray-100 to-gray-200 hover:from-gray-200 hover:to-gray-300 text-gray-800 px-6 py-3 rounded-lg flex items-center justify-center shadow-md hover:shadow-lg transition-all border border-gray-200">
                        <i class="fas fa-share-alt mr-3 text-xl"></i>
                        <span class="font-medium">Share</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Verification Section with Enhanced Design -->
    <div class="max-w-4xl mx-auto mt-10 bg-white rounded-xl shadow-lg overflow-hidden border border-gray-100">
        <div class="p-8">
            <div class="flex items-center mb-6">
                <div class="bg-blue-100 p-3 rounded-full mr-4">
                    <i class="fas fa-shield-alt text-blue-600 text-xl"></i>
                </div>
                <h3 class="text-2xl font-semibold text-gray-900">Certificate Verification</h3>
            </div>
            
            <div class="flex flex-col md:flex-row items-center justify-between bg-blue-50 rounded-lg p-6">
                <div class="mb-4 md:mb-0">
                    <p class="text-gray-600 mb-2">Verify this certificate at:</p>
                    <div class="flex items-center bg-white rounded-md p-2 border border-gray-200">
                        <i class="fas fa-link text-gray-400 mr-2 ml-1"></i>
                        <p class="font-mono text-blue-600 truncate max-w-xs">{{ verification_url }}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    {% if certificate.is_verified %}
                    <span class="bg-green-100 text-green-800 px-4 py-2 rounded-full text-sm font-medium flex items-center">
                        <i class="fas fa-check-circle mr-2"></i> Verified
                    </span>
                    {% endif %}
                    <button onclick="copyVerificationLink()" 
                            class="text-white bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 px-4 py-2 rounded-lg flex items-center shadow hover:shadow-md transition-all">
                        <i class="fas fa-copy mr-2"></i> Copy Link
                    </button>
                </div>
            </div>
            
            <div class="mt-6 pt-6 border-t border-gray-100 flex items-center">
                <i class="fas fa-info-circle text-blue-500 mr-3 text-xl"></i>
                <p class="text-gray-600 text-sm">This certificate is digitally signed and can be verified online to confirm its authenticity.</p>
            </div>
        </div>
    </div>
</div>

<script>
 function shareCertificate() {
        {% if certificate.pdf_file and certificate.pdf_file.name %}
        const pdfUrl = "{{ certificate.pdf_file.url }}";
    {% else %}
        const pdfUrl = "";
    {% endif %}

        if (navigator.share) {
            navigator.share({
                title: 'My Certificate for {{ certificate.module.name }}',
                text: 'Check out my certificate for completing {{ certificate.module.name }}',
                url: window.location.origin + pdfUrl
            }).catch(err => {
                console.log('Error sharing:', err);
            });
        } else {
            // Fallback for browsers without Web Share API
            const el = document.createElement('textarea');
            el.value = window.location.origin + pdfUrl;
            document.body.appendChild(el);
            el.select();
            document.execCommand('copy');
            document.body.removeChild(el);

            // Toast
            const toast = document.createElement('div');
            toast.className = 'fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg flex items-center animate-fade-in';
            toast.innerHTML = `
                <i class="fas fa-check-circle mr-2 text-green-400"></i>
                Certificate PDF link copied to clipboard!
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.classList.add('animate-fade-out');
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
    }

function copyVerificationLink() {
    const el = document.createElement('textarea');
    el.value = '{{ verification_url }}';
    document.body.appendChild(el);
    el.select();
    document.execCommand('copy');
    document.body.removeChild(el);
    
    // Show a nice toast notification
    const toast = document.createElement('div');
    toast.className = 'fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg flex items-center animate-fade-in';
    toast.innerHTML = `
        <i class="fas fa-check-circle mr-2 text-green-400"></i>
        Verification link copied to clipboard!
    `;
    document.body.appendChild(toast);
    
    setTimeout(() => {
        toast.classList.add('animate-fade-out');
        setTimeout(() => toast.remove(), 300);
    }, 3000);
}
</script>

<style>
@keyframes fade-in {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

@keyframes fade-out {
    from { opacity: 1; transform: translateY(0); }
    to { opacity: 0; transform: translateY(10px); }
}

.animate-fade-in {
    animation: fade-in 0.3s ease-out forwards;
}

.animate-fade-out {
    animation: fade-out 0.3s ease-out forwards;
}

.font-serif {
    font-family: 'Georgia', serif;
}
</style>
{% endblock %}